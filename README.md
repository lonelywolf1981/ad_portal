# AD Portal — Этап 1 (Docker Compose)

## Что реализовано
- Локальная авторизация (пользователи приложения в SQLite)
- Настройки приложения в БД (SQLite), включая параметры подключения к AD
- Переключение режима авторизации: LOCAL / AD
- Раздельные группы:
  - кто может входить в приложение (AD)
  - кто может открывать настройки (AD)
- Простая форма AD-настроек:
  - DC: `DC1`
  - Домен: `ubc.local.net`
  - bind-логин: только имя пользователя (например `ldap_bind`)
  - пароли не хранятся в открытом виде (шифрование в БД)
- Кнопка “Проверить и загрузить группы”: проверяет bind и подтягивает группы из AD
- HTMX для динамического обновления результата теста/списков групп
- Nginx reverse proxy наружу на порт `8484` (можно поменять в docker-compose.yml)

## Быстрый запуск
1) Подготовить:
```bash
cp .env.example .env
mkdir -p data
# Если контейнер не может писать SQLite:
sudo chmod 777 data
```

2) Поднять:
```bash
docker compose up -d --build
```

3) Открыть:
- `http://<IP_хоста>:8484/login`

## Первый вход
Если локальных пользователей нет, при старте создаётся bootstrap admin из `.env`:
- `BOOTSTRAP_ADMIN_USER`
- `BOOTSTRAP_ADMIN_PASSWORD`

Зайдите локально и откройте:
- `http://<IP_хоста>:8484/settings`

## Настройка AD
На странице настроек:
- DC: например `DC1`
- Домен: например `ubc.local.net`
- Выберите режим подключения: `LDAPS` или `LDAP + StartTLS`
- Bind user: например `ldap_bind` (приложение само использует principal вида `ldap_bind@ubc.local.net`)
- Нажмите “Проверить и загрузить группы”
- Выберите группы для:
  - доступа в приложение
  - доступа к настройкам
- Включите режим авторизации `AD` и сохраните

## Примечания
- Даже при режиме `AD` локальные админы могут войти (break-glass), чтобы не заблокировать настройки.
